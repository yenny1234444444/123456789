const ResponseBody = require('../../../shared/model/ResponseBody.model');
const { createUser, viewUsers, updateUser, deleteUser, loginUser } = require('../controller/auth.controller');

const createUserAPI = async (req, res) => {
  let { nombreCompleto, tipoDocumento, documento, contrasena, rol, estado, correo } = req.body;
  let message;

  try {
    let response = await createUser({ nombreCompleto, tipoDocumento, documento, contrasena, rol, estado, correo });
    message = new ResponseBody(true, 200, response);
  } catch (error) {
    if (error.statusCode) {
      message = new ResponseBody(error.ok, error.statusCode, error.data);
    } else {
      console.log(error);
      message = new ResponseBody(false, 500, 'Ocurrió un error al procesar la solicitud.');
    }
  }

  return res.json(message);
}

const viewUsersAPI = async (req, res) => {
  let message;

  try {
    let response = await viewUsers();
    message = new ResponseBody(true, 200, response);
  } catch (error) {
    if (error.statusCode) {
      message = new ResponseBody(error.ok, error.statusCode, error.data);
    } else {
      console.log(error);
      message = new ResponseBody(false, 500, 'Ocurrió un error al procesar la solicitud.');
    }
  }

  return res.json(message);
}

const updateUserAPI = async (req, res) => {
  let { nombreCompleto, tipoDocumento, documento, contrasena, rol, estado, correo, id } = req.body;
  let message;

  if (!id) {
    return res.json(new ResponseBody(false, 400, 'El ID del usuario es requerido.'));
  }

  try {
    let response = await updateUser({ nombreCompleto, tipoDocumento, documento, contrasena, rol, estado, correo, id });
    message = new ResponseBody(true, 200, response);
  } catch (error) {
    if (error.statusCode) {
      message = new ResponseBody(error.ok, error.statusCode, error.data);
    } else {
      console.log(error);
      message = new ResponseBody(false, 500, 'Ocurrió un error al procesar la solicitud.');
    }
  }

  return res.json(message);
}

const deleteUserAPI = async (req, res) => {
  let { id } = req.body;
  let message;

  if (!id) {
    return res.json(new ResponseBody(false, 400, 'El ID del usuario es requerido.'));
  }

  try {
    let response = await deleteUser({ id });
    message = new ResponseBody(true, 200, response);
  } catch (error) {
    if (error.statusCode) {
      message = new ResponseBody(error.ok, error.statusCode, error.data);
    } else {
      console.log(error);
      message = new ResponseBody(false, 500, 'Ocurrió un error al procesar la solicitud.');
    }
  }

  return res.json(message);
}
const loginUserAPI = async (req, res) => {
  let { documento, contrasena, correo } = req.body;
  let message;

  try {
    let response = await loginUser({ documento, contrasena, correo });
    message = new ResponseBody(true, 200, response);
  } catch (error) {
    if (error.statusCode) {
      message = new ResponseBody(error.ok, error.statusCode, error.data);
    } else {
      console.log(error);
      message = new ResponseBody(false, 500, 'Ocurrió un error al procesar la solicitud.');
    }
  }

  return res.json(message);
}

module.exports = {
  createUserAPI,
  viewUsersAPI,
  updateUserAPI,
  deleteUserAPI,
  loginUserAPI,
};
